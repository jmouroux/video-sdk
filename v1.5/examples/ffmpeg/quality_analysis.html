


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="XMA Examples for the Xilinx Video SDK" href="../xma/xma_apps.html" />
    <link rel="prev" title="FFmpeg Examples using Software Filters" href="filters.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
<!-- 																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul> -->
																</div>
															</div>
															<script type="text/javascript" src="../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Xilinx Video SDK
          

          
          </a>

          
            
            
              <div class="version">
                1.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_prem.html">On Premises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_vt1.html">Amazon EC2 VT1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../container_setup.html">Container Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Tutorials and Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorials.html">FFmpeg Introductory Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="filters.html">FFmpeg Software Filters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">FFmpeg Visual Quality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction-to-video-quality">Introduction to Video Quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimized-settings-for-the-sdk">Optimized Settings for the Xilinx Video SDK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#subjective-quality">Subjective Quality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#objective-quality">Objective Quality</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-differences-between-objective-and-subjective-quality">Setting Differences Between Objective and Subjective Quality</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-psnr-ssim-vmaf-scores">Running PSNR/SSIM/VMAF scores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quality-vs-latency">Quality vs. Latency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#xilinx-specific-latency-flags">Xilinx-Specific Latency Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optimized-settings-for-low-latency-streams">Optimized Settings for Low Latency Streams</a></li>
<li class="toctree-l4"><a class="reference internal" href="#measuring-latency">Measuring Latency</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../xma/xma_apps.html">C-Based Applications</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../specs_and_features.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../managing_compute_resources.html">Managing Compute Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploying_with_kubernetes.html">Deploying with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_apis.html">C API Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../card_management.html">Card Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

            
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Xilinx Video SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../examples.html">Tutorials and Examples</a> &raquo;</li>
        
      <li>Video Quality Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="video-quality-examples">
<h1>Video Quality Examples<a class="headerlink" href="#video-quality-examples" title="Permalink to this headline">¶</a></h1>
<p>This page is dedicated to explaining some of the details behind Video Quality (VQ), how it is measured, and how you can optimize your FFmpeg commands with the Xilinx Video SDK to maximize its performance.</p>
<p>Further documentation on this topic can be found in the <a class="reference internal" href="../../using_ffmpeg.html#tuning-encoder-options"><span class="std std-ref">Tuning Encoder Options</span></a> section of the Xilinx Video SDK user guide.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction-to-video-quality" id="id1">Introduction to Video Quality</a></p></li>
<li><p><a class="reference internal" href="#optimized-settings-for-the-sdk" id="id2">Optimized Settings for the Xilinx Video SDK</a></p>
<ul>
<li><p><a class="reference internal" href="#subjective-quality" id="id3">Subjective Quality</a></p></li>
<li><p><a class="reference internal" href="#objective-quality" id="id4">Objective Quality</a></p></li>
<li><p><a class="reference internal" href="#setting-differences-between-objective-and-subjective-quality" id="id5">Setting Differences Between Objective and Subjective Quality</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-psnr-ssim-vmaf-scores" id="id6">Running PSNR/SSIM/VMAF scores</a></p></li>
<li><p><a class="reference internal" href="#quality-vs-latency" id="id7">Quality vs. Latency</a></p>
<ul>
<li><p><a class="reference internal" href="#xilinx-specific-latency-flags" id="id8">Xilinx-Specific Latency Flags</a></p></li>
<li><p><a class="reference internal" href="#optimized-settings-for-low-latency-streams" id="id9">Optimized Settings for Low Latency Streams</a></p></li>
<li><p><a class="reference internal" href="#measuring-latency" id="id10">Measuring Latency</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction-to-video-quality">
<h2><a class="toc-backref" href="#id1">Introduction to Video Quality</a><a class="headerlink" href="#introduction-to-video-quality" title="Permalink to this headline">¶</a></h2>
<p>There has been a longstanding goal for video engineers to quantitatively determine the output quality of an encoder without having to watch and inspect every individual frame. This has led to an evolution of algorithmic solutions, the most common of which are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Peak_signal-to-noise_ratio">Peak Signal to Noise Ratio (PSNR)</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Structural_similarity">Structural Similarity Index Metric (SSIM)</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Video_Multimethod_Assessment_Fusion">Video Multimethod Assessment Fusion (VMAF)</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Mean_opinion_score">Mean Opinion Score (MOS) - Humans visually watching the screen and providing feedback</a></p></li>
</ul>
<p>Many people will argue which metric is best (although PSNR is commonly considered the least accurate). Jan Ozer from the Streaming Media Center posted his experimental correlation of MOS vs the above metrics. You can review the findings <a class="reference external" href="https://streaminglearningcenter.com/wp-content/uploads/2017/08/PSRN-vs.-VMAF-vs.-SSIMPlus.pdf">here.</a></p>
<p>Furthermore, due to the industry standard of tracking encoder “performance” to quantitative metrics like the ones listed above, many encoders have “taught to the test”; that is, they provide different command-line arguments that will give higher scores but may look worse to the human eye. For example, common CPU encoders <a class="reference external" href="https://code.videolan.org/videolan/x264">x264</a> and <a class="reference external" href="http://hg.videolan.org/x265">x265</a> have a <code class="docutils literal notranslate"><span class="pre">tune</span></code> parameter which optimizes to objective metrics.</p>
<p>This page discusses the Xilinx Video SDK command line flags used to optimize for objective quality (scores) and subjective quality (visual appeal) and provides additional details as to what is happening behind the scenes and why.</p>
</div>
<div class="section" id="optimized-settings-for-the-sdk">
<h2><a class="toc-backref" href="#id2">Optimized Settings for the Xilinx Video SDK</a><a class="headerlink" href="#optimized-settings-for-the-sdk" title="Permalink to this headline">¶</a></h2>
<p>It is highly recommended to perform encoding on raw video clips; that is, clips that have not undergone a transform/compression/encoding in the past. This ensures that the clips are in a universally known state in order to fairly compare encoders.</p>
<p>Alternatively, you can add the flags to decode before encoding, and the results will remain accurate as long as the same pre-encoded file is used as the source across all encoders under test. Information on this process can be found on the <a class="reference internal" href="tutorials.html"><span class="doc">FFmpeg tutorial page</span></a>.</p>
<p>Flags not illustrated in this page are covered in the <a class="reference internal" href="../../using_ffmpeg.html"><span class="doc">Using FFmpeg</span></a> chapter of the Xilinx Video SDK user guide.</p>
<div class="section" id="subjective-quality">
<h3><a class="toc-backref" href="#id3">Subjective Quality</a><a class="headerlink" href="#subjective-quality" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/188ad5cb515c2c3f1e1059d7a25ba761/h264_subjective.sh"><code class="xref download docutils literal notranslate"><span class="pre">h264_subjective.sh</span></code></a>
<a class="reference download internal" download="" href="../../_downloads/805f66e06cbd02de43b191f88466469d/hevc_subjective.sh"><code class="xref download docutils literal notranslate"><span class="pre">hevc_subjective.sh</span></code></a></p>
<p>These are the command you should use to get maximum video quality to the human eye in most situations. It accepts a clip that is already decoded or a RAW YUV.</p>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./h264_subjective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
./hevc_subjective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
</pre></div>
</div>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -pix_fmt yuv420p -s:v 1920x1080 -r 60 -i $INPUT \
-vsync 0 \
-b:v ${BITRATE}K \
-c:v ${CODEC} \
-f ${FORMAT} \
-bf 1 \
-g 120 \
-periodicity-idr 120 \
-qp-mode relative-load \
-lookahead_depth 20 \
-spatial-aq 1 \
-temporal-aq 1 \
-y ./${INPUT}_${BITRATE}_${TEST}.${EXTENSION}
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span> <span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span> <span class="pre">-s:v</span> <span class="pre">1920x1080</span> <span class="pre">-r</span> <span class="pre">60</span> <span class="pre">-i</span> <span class="pre">$INPUT</span></code></p>
<ul>
<li><p>This line takes a YUV420 1080p60 file as the input</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-vsync</span> <span class="pre">0</span></code></p>
<ul>
<li><p>This line is an <a class="reference external" href="https://ffmpeg.org/ffmpeg.html#Advanced-options">advanced FFmpeg flag</a></p></li>
<li><p>Setting it to 0 passes through every frame to the decoder as it is delivered. Other settings are used to ‘help’ the encode process by modifying the content; for example, FFmpeg often duplicates the first frame.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">0</span></code> setting ensures nothing is changed/added/dropped, which is perfect for calculating VQ</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">${BITRATE}K</span></code></p>
<ul>
<li><p>This flag takes the 2nd parameter from the script and sets the desired target bitrate of the output video clip.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">${CODEC}</span></code></p>
<ul>
<li><p>This flag defines the encoder shall be the either <code class="docutils literal notranslate"><span class="pre">mpsoc_vcu_h264</span></code> or <code class="docutils literal notranslate"><span class="pre">mpsoc_vcu_hevc</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">${FORMAT}</span></code></p>
<ul>
<li><p>This flag defines what the output format shall be, for example an <code class="docutils literal notranslate"><span class="pre">h264</span></code> or <code class="docutils literal notranslate"><span class="pre">hevc</span></code> elementary container (as opposed, to say, mp4)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-bf</span> <span class="pre">1</span></code></p>
<ul>
<li><p>This flag outlines the number of B-frames shall be inserted</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span> <span class="pre">120</span></code></p>
<ul>
<li><p>This sets the I-Frame interval; which means a full picture of data (instead of difference-frames P &amp; B) is sent every 120 frames.</p></li>
<li><p>Livestreaming protocols prefer (some require) “2 seconds”. Since our input to the script expects a 60fps file, its set to 120; a 30fps source would be set to 60.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-periodicity-idr</span> <span class="pre">120</span></code></p>
<ul>
<li><p>This sets the period of an IDR frame to every 120 frames. This means that the “reference buffer” is flushed, or in other words “don’t let any future frame reference a frame before me”.</p></li>
<li><p>This greatly helps in allowing decoders/players to seek to different parts of the video</p></li>
<li><p>This is also used in online streaming for ad-insertion.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-qp-mode</span> <span class="pre">relative-mode</span></code></p>
<ul>
<li><p>This is a setting wherein data from the lookahead buffer (custom written in the FPGA) is used to assign the best quantization for each macroblock. Use this mode only when lookahead is enabled.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-lookahead_depth</span> <span class="pre">20</span></code></p>
<ul>
<li><p>The lookahead is the buffer depth of, in this case, 20 frames.</p></li>
<li><p>the LA Buffer is the number of frames the encoder looks at in a single pass to determine how best to compress the data temporarily.</p></li>
<li><p>Increasing the buffer increases both the latency and quality of your compression</p></li>
<li><p>When lookahead is enabled, spatial-aq and temporal-aq are enabled by default and qp-mode is set to relative-load automatically.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-spatial-aq</span> <span class="pre">1</span></code></p>
<ul>
<li><p>Turns on Spatial Adaptive Quantization</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-temporal-aq</span> <span class="pre">1</span></code></p>
<ul>
<li><p>Turns on Temporal Adaptive Quantization</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">./${INPUT}_${BITRATE}_${TEST}.${EXTENSION}</span></code></p>
<ul>
<li><p>Overwrite any existing file via <code class="docutils literal notranslate"><span class="pre">-y</span></code> and save it to the working directory: e.g. <code class="docutils literal notranslate"><span class="pre">./myclip_4000K_objective.264</span></code> or <code class="docutils literal notranslate"><span class="pre">./myclip_2000K_subjective.hevc</span></code>.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="objective-quality">
<h3><a class="toc-backref" href="#id4">Objective Quality</a><a class="headerlink" href="#objective-quality" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/566caf2b90971ad7c07150197eed5364/h264_objective.sh"><code class="xref download docutils literal notranslate"><span class="pre">h264_objective.sh</span></code></a>
<a class="reference download internal" download="" href="../../_downloads/1d0b72b58801dfa8489ca2cdeeffdc7e/hevc_objective.sh"><code class="xref download docutils literal notranslate"><span class="pre">hevc_objective.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./h264_objective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
./hevc_objective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
</pre></div>
</div>
<p>This is the command you should run to get maximum objective scoring (PSNR, SSIM, VMAF). It accepts a clip that is already decoded or a RAW YUV.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -pix_fmt yuv420p -s:v 1920x1080 -r 60 -i $INPUT \
-vsync 0 \
-b:v ${BITRATE}K \
-c:v ${CODEC} \
-f ${FORMAT} \
-bf 1 \
-g 120 \
-periodicity-idr 120 \
-tune-metrics 1 \
-lookahead_depth 20 \
-y ./${INPUT}_${BITRATE}_${TEST}.${EXTENSION}
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span> <span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span> <span class="pre">-s:v</span> <span class="pre">1920x1080</span> <span class="pre">-r</span> <span class="pre">60</span> <span class="pre">-i</span> <span class="pre">$INPUT</span></code></p>
<ul>
<li><p>This line takes a YUV420 1080p60 file as the input</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-vsync</span> <span class="pre">0</span></code></p>
<ul>
<li><p>This line is an <a class="reference external" href="https://ffmpeg.org/ffmpeg.html#Advanced-options">advanced FFmpeg flag</a></p></li>
<li><p>Setting it to 0 passes through every frame to the decoder as it is delivered. Other settings are used to ‘help’ the encode process by modifying the content; for example, FFmpeg often duplicates the first frame.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">0</span></code> setting ensures nothing is changed/added/dropped, which is perfect for calculating VQ</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">${BITRATE}K</span></code></p>
<ul>
<li><p>This flag takes the 2nd parameter from the script and sets the desired target bitrate of the output video clip.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">${CODEC}</span></code></p>
<ul>
<li><p>This flag defines the encoder shall be the either <code class="docutils literal notranslate"><span class="pre">mpsoc_vcu_h264</span></code> or <code class="docutils literal notranslate"><span class="pre">mpsoc_vcu_hevc</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">${FORMAT}</span></code></p>
<ul>
<li><p>This flag defines what the output format shall be, for example an <code class="docutils literal notranslate"><span class="pre">h264</span></code> or <code class="docutils literal notranslate"><span class="pre">hevc</span></code> elementary container (as opposed, to say, mp4)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-bf</span> <span class="pre">1</span></code></p>
<ul>
<li><p>This flag outlines the number of B-frames shall be inserted</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span> <span class="pre">120</span></code></p>
<ul>
<li><p>This sets the I-Frame interval; which means a full picture of data (instead of difference-frames P &amp; B) is sent every 120 frames.</p></li>
<li><p>Livestreaming protocols prefer (some require) “2 seconds”. Since our input to the script expects a 60fps file, its set to 120; a 30fps source would be set to 60.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-periodicity-idr</span> <span class="pre">120</span></code></p>
<ul>
<li><p>This sets the period of an IDR frame to every 120 frames. This means that the “reference buffer” is flushed, or in other words “don’t let any future frame reference a frame before me”.</p></li>
<li><p>This greatly helps in allowing decoders/players to seek to different parts of the video</p></li>
<li><p>This is also used in online streaming for ad-insertion.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-tune-metrics</span> <span class="pre">1</span></code></p>
<ul>
<li><p>Tunes video quality for objective scores by setting qp-mode to uniform and scaling-list to flat. Also, it turns OFF spatial-aq and temporal-aq when lookahead is enabled, to improve objective scores.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-scaling-list</span> <span class="pre">0</span></code></p>
<ul>
<li><p>Sets the scaling list to flat</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-lookahead_depth</span> <span class="pre">20</span></code></p>
<ul>
<li><p>The lookahead is the buffer depth, in this case, 20 frames.</p></li>
<li><p>the LA Buffer is the number of frames the encoder looks at in a single pass to determine how best to compress the data temporarily.</p></li>
<li><p>Increasing the buffer increases both the latency and quality of your compression</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">./${INPUT}_${BITRATE}_${TEST}.${EXTENSION}</span></code></p>
<ul>
<li><p>Overwrite any existing file via <code class="docutils literal notranslate"><span class="pre">-y</span></code> and save it to the working directory: e.g. <code class="docutils literal notranslate"><span class="pre">./myclip_4000K_objective.264</span></code> or <code class="docutils literal notranslate"><span class="pre">./myclip_2000K_subjective.hevc</span></code>.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setting-differences-between-objective-and-subjective-quality">
<h3><a class="toc-backref" href="#id5">Setting Differences Between Objective and Subjective Quality</a><a class="headerlink" href="#setting-differences-between-objective-and-subjective-quality" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-qp-mode</span></code></p>
<ul>
<li><p>How an encoder quantizes its CU’s (Macroblocks/Coding Tree Units/etc.) is what fundamentally defines a large amount of its quality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniform</span></code> load <strong>(objective)</strong> equally quantizes all CU’s within a slice.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relative-load</span></code> <strong>(subjective)</strong> adds another layer of analysis before the encoder and provides “hints” to the encoder; improves video quality but again, mathematically ‘breaks’ the image, resulting in lower scores.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-scaling_list</span></code></p>
<ul>
<li><p>The scaling list is used to scale up low-frequency data in the stream such that when it is quantized down during the encoding process, detail is retained.</p></li>
<li><p>This process specifically modifies parts of the scene and not others, which in most objective metrics is purposely “breaking” it, reducing its score.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">spatial-aq</span></code> and <code class="docutils literal notranslate"><span class="pre">temporal-aq</span></code></p>
<ul>
<li><p>Adaptive Quantization (AQ) exploits the fact that the human eye is more sensitive to certain regions of a frame. This method drops information from high-frequency locations and keeps more information in low-frequency locations in a frame. The result appears more visually appealing. To enable spatial or temporal AQ, qp-mode should be set to relative-load and lookahead should be enabled.</p></li>
<li><p>Imagine a scene of a windy forest: the moving leaves (high frequency/texture data), and tree trunks on the ground (low-frequency/texture data). Artifacts and issues in the low-frequency data will catch your eye much more than the high-frequency data. AQ will drop data in the leaves (they are much harder to see changes from frame-to-frame) and make sure the trunks and ground keep more of their data. It is a zero-sum game when compressing data.</p></li>
<li><p>Spatial AQ is redistribution of bits/data within a frame, while temporal AQ is data over time (i.e. over many frames). With Temporal AQ, the same concepts apply: high-motion regions are less noticeable than low-motion regions; Temporal AQ looks ahead in the Lookahead buffer to determine which is which and will redistribute bits/data accordingly for a more visually appealing scene.</p></li>
<li><p>There is another flag which is enabled (but is set to default in these strings, so it is omitted in the command line) with <code class="docutils literal notranslate"><span class="pre">spatial-aq</span></code>. The flag is <code class="docutils literal notranslate"><span class="pre">-spatial-aq-gain</span></code> and can be set 0-100; default is 50. This parameter is the strength of the redistribution of data within the frame. Setting too high a value may have a consequence of blurring edges. Experimentation across your clips is recommended if you wish to tune the parameter. We keep it to 50(%) to cover the widest set of use cases.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="running-psnr-ssim-vmaf-scores">
<h2><a class="toc-backref" href="#id6">Running PSNR/SSIM/VMAF scores</a><a class="headerlink" href="#running-psnr-ssim-vmaf-scores" title="Permalink to this headline">¶</a></h2>
<p>Due to licensing reasons, the FFmpeg binary delivered in this package does not include a comprehensive set of codecs or plugins required for scoring video quality. You have many options:</p>
<ol class="arabic simple">
<li><p>(Easiest) Download a static FFmpeg build from <a class="reference external" href="https://johnvansickle.com/ffmpeg/">John Van Sickle</a>  which has VMAF (among other plugins) precompiled + installed</p></li>
<li><p><a class="reference external" href="https://trac.ffmpeg.org/wiki/CompilationGuide">Recompile another version FFmpeg</a> and include the <a class="reference external" href="https://github.com/Netflix/vmaf/">VMAF library</a></p></li>
<li><p>Recompile the FFmpeg starting from the source code included in this repository and include the <a class="reference external" href="https://github.com/Netflix/vmaf/">VMAF library</a>. For instructions on how to customize and rebuild the FFmpeg provided with the Xilinx Video SDK, see the <a class="reference internal" href="../../using_ffmpeg.html#rebuild-ffmpeg"><span class="std std-ref">Rebuilding FFmpeg</span></a> section.</p></li>
</ol>
<p><a class="reference download internal" download="" href="../../_downloads/eefb23e8dc6254ee16ca686711f61c9e/measure_vq.sh"><code class="xref download docutils literal notranslate"><span class="pre">measure_vq.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./measure_vq.sh &lt;Distorted Encoded Clip&gt; &lt;Resolution (&#39;W&#39;x&#39;H&#39;)&gt; &lt;Framerate&gt; &lt;Master YUV&gt; [Custom FFmpeg path]
</pre></div>
</div>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>${FFMPEG_PATH}/ffmpeg -i $DISTORTED -framerate $FRAMERATE -s $RESOLUTION -pix_fmt yuv420p -i $MASTER \
-lavfi libvmaf=&quot;log_fmt=json:ms_ssim=1:ssim=1:psnr=1:log_path=/tmp/${filename}.vmaf.json:model_path=${FFMPEG_PATH}/model/${MODEL}&quot; -f null -
</pre></div>
</div>
<p>Explanation of the command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">${FFMPEG_PATH}ffmpeg</span></code></p>
<ul>
<li><p>This launches an FFmpeg, which can be overloaded/changed with a variable <code class="docutils literal notranslate"><span class="pre">FFMPEG_PATH</span></code>, otherwise it will use the default FFmpeg in the $PATH</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">$DISTORTED</span></code></p>
<ul>
<li><p>This is the encoded file which is under test/scoring</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-framerate</span> <span class="pre">$FRAMERATE</span></code></p>
<ul>
<li><p>This is the framerate of the original (called MASTER) clip in RAW form.</p></li>
<li><p>If your original/master clip is in an encoded format, you may omit this flag</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">$RESOLUTION</span></code></p>
<ul>
<li><p>This is the resolution of the original (called MASTER) clip in RAW form</p></li>
<li><p>The format is <code class="docutils literal notranslate"><span class="pre">&lt;W&gt;x&lt;H&gt;</span></code>, for example <code class="docutils literal notranslate"><span class="pre">1920x1080</span></code> or <code class="docutils literal notranslate"><span class="pre">1280x720</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">$PIX_FMT</span></code></p>
<ul>
<li><p>This is the colorspace of the original (called MASTER) clip in RAW form</p></li>
<li><p>To see supported pixel formats use <code class="docutils literal notranslate"><span class="pre">${FFMPEG_PATH}ffmpeg</span> <span class="pre">-pix_fmts</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">$MASTER</span></code></p>
<ul>
<li><p>This takes a second input which is the master/golden/original file to which you are comparing the encoded $DISTORTED file to.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-lavfi</span> <span class="pre">libvmaf=</span></code></p>
<ul>
<li><p>This enables the filter titled <code class="docutils literal notranslate"><span class="pre">libvmaf</span></code> which has the following flags/parameters in the next bullets</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_fmt=json</span></code></p>
<ul>
<li><p>This sets the log format to JSON, you can also use <code class="docutils literal notranslate"><span class="pre">xml</span></code> for XML output</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ms_ssim=1</span></code></p>
<ul>
<li><p>Enables the more robust SSIM testing, MultiScale SSIM and adds the results to the logfile</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssim=1</span></code></p>
<ul>
<li><p>Enables the standard SSIM testing, and adds it to the logfile</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">psnr=1</span></code></p>
<ul>
<li><p>Enables the standard PSNR testing, and adds it to the logfile</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_path=/tmp/${DISTORTED}.vmaf.json</span></code></p>
<ul>
<li><p>Sets the output logfile path</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">model_path=${FFMPEG_PATH}/vmaf/model/${MODEL}</span></code></p>
<ul>
<li><p><strong>This is important</strong> This flag determines the model that VMAF is computed against at a resolution level</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vmaf_4k_v0.6.1.pkl</span></code> is used for 4k</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vmaf_float_v0.6.1.pkl</span></code> is used for smaller resolutions (depending on version of your library may just be called <code class="docutils literal notranslate"><span class="pre">vmaf_v0.6.1.pkl</span></code></p></li>
<li><p>Other models exist and are documented <a class="reference external" href="https://github.com/Netflix/vmaf/blob/master/resource/doc/models.md">on the VMAF GitHub</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">null</span> <span class="pre">-</span></code></p>
<ul>
<li><p>The filter (<code class="docutils literal notranslate"><span class="pre">libvmaf</span></code>) has the infrastructure to write the output log. We do not need FFmpeg to output any files, so we set the output to <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="quality-vs-latency">
<h2><a class="toc-backref" href="#id7">Quality vs. Latency</a><a class="headerlink" href="#quality-vs-latency" title="Permalink to this headline">¶</a></h2>
<p>A given encoder’s “quality” is often a function of many different algorithms/functions/features. It is quite possible (and often seen) that an encoder can produce an h.264/HEVC compliant stream but have drastically different quality from one to another.</p>
<p>Some of these features add latency, either by adding “pitstops” on the way to an outputted stream, or by increasing the complexity of the core-encoding functions. Most things in the video realm are content-dependent, or use-case-dependent, so the designer needs to determine what is best for them… a gradient of:</p>
<ul class="simple">
<li><p>absolute best quality with high latency</p></li>
<li><p>lower quality with lowest latency.</p></li>
</ul>
<div class="section" id="xilinx-specific-latency-flags">
<h3><a class="toc-backref" href="#id8">Xilinx-Specific Latency Flags</a><a class="headerlink" href="#xilinx-specific-latency-flags" title="Permalink to this headline">¶</a></h3>
<div class="section" id="decoder-options">
<h4>Decoder Options<a class="headerlink" href="#decoder-options" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-low_latency</span></code></p>
<ul>
<li><p>This flag when set to 0 disables the decoder’s ability to process B-frames. Skipping this logic and providing an input with B-Frames will have jittery, undesired outputs.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="encoder-options">
<h4>Encoder Options<a class="headerlink" href="#encoder-options" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-control-rate</span> <span class="pre">low-latency</span></code></p>
<ul>
<li><p>While this flag is documented, it <strong>should not be used</strong>, please ignore it</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-bf</span> <span class="pre">&lt;INT&gt;</span></code></p>
<ul>
<li><p>This is the number of B-Frames inserted into the GOP. B-frames reference both past and future frames, so to build them, it will be required to have a buffer.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-lookahead_depth</span> <span class="pre">&lt;INT&gt;</span></code></p>
<ul>
<li><p>In order to best determine how best to encode the incoming video, you can create a buffer that the encoder can use to search for clues/hints. It drastically improves quality, but every frame you provide is another frame of latency.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-qp-mode</span> <span class="pre">relative-load</span></code></p>
<ul>
<li><p>Using the FPGA, we are preprocessing the stream and making intelligent decisions which we can provide to the encoder as “hints”. Adding this step helps improve quality at the cost of latency.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auto</span></code> uses a more basic engine and will be slightly faster, lower quality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniform</span></code> is fastest at the lowest quality for this option</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-scaling</span> <span class="pre">list</span></code></p>
<ul>
<li><p>Enabling this allows for an extra step of scaling low-frequency coefficients before they are quantized in the encoder. When enabled, better quality, higher latency; when disabled, lower quality, better/lower latency.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-temporal-aq</span></code> and <code class="docutils literal notranslate"><span class="pre">-spatial-aq</span></code></p>
<ul>
<li><p>These features are described above on this page; performing their functions increases both latency and quality.</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="optimized-settings-for-low-latency-streams">
<h3><a class="toc-backref" href="#id9">Optimized Settings for Low Latency Streams</a><a class="headerlink" href="#optimized-settings-for-low-latency-streams" title="Permalink to this headline">¶</a></h3>
<p>With the above information in hand, below are the optimized commands for general types of video. Your content may require modifications to optimize fully.</p>
<div class="section" id="low-latency-subjective-quality">
<h4>Low Latency Subjective Quality<a class="headerlink" href="#low-latency-subjective-quality" title="Permalink to this headline">¶</a></h4>
<p><a class="reference download internal" download="" href="../../_downloads/6b39baffc9cb695662b13c1dc3098b69/h264_ll_subjective.sh"><code class="xref download docutils literal notranslate"><span class="pre">h264_ll_subjective.sh</span></code></a>
<a class="reference download internal" download="" href="../../_downloads/cc98508468d50a3bf7921ade274157eb/hevc_ll_subjective.sh"><code class="xref download docutils literal notranslate"><span class="pre">hevc_ll_subjective.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./h264_ll_subjective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
./hevc_ll_subjective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
</pre></div>
</div>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -pix_fmt yuv420p -s:v 1920x1080 -r 60 -i $INPUT \
-vsync 0 \
-b:v ${BITRATE}K \
-c:v ${CODEC} \
-f ${FORMAT} \
-bf 0 \
-g 120 \
-periodicity-idr 120 \
-qp-mode auto \
-y ${INPUT}_${BITRATE}_${TEST}.${EXTENSION}
</pre></div>
</div>
</div>
<div class="section" id="low-latency-objective-quality">
<h4>Low Latency Objective Quality<a class="headerlink" href="#low-latency-objective-quality" title="Permalink to this headline">¶</a></h4>
<p><a class="reference download internal" download="" href="../../_downloads/5492d4c251aaa0cf05e97b4d047111a7/h264_ll_objective.sh"><code class="xref download docutils literal notranslate"><span class="pre">h264_ll_objective.sh</span></code></a>
<a class="reference download internal" download="" href="../../_downloads/26cb80cb9761b9e457266c5669be7401/hevc_ll_objective.sh"><code class="xref download docutils literal notranslate"><span class="pre">hevc_ll_objective.sh</span></code></a></p>
<p><strong>Usage</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./h264_ll_objective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
./hevc_ll_objective.sh &lt;1080p60 YUV file&gt; &lt;bitrate in Kbps&gt;
</pre></div>
</div>
<p><strong>Command Line</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -pix_fmt yuv420p -s:v 1920x1080 -r 60 -i $INPUT \
-vsync 0 \
-b:v ${BITRATE}K \
-c:v ${CODEC} \
-f ${FORMAT} \
-bf 0 \
-g 120 \
-periodicity-idr 120 \
-tune-metrics 1 \
-y ${INPUT}_${BITRATE}_${TEST}.${EXTENSION}
</pre></div>
</div>
</div>
</div>
<div class="section" id="measuring-latency">
<h3><a class="toc-backref" href="#id10">Measuring Latency</a><a class="headerlink" href="#measuring-latency" title="Permalink to this headline">¶</a></h3>
<p>Each of the plugins from Xilinx (Decoder, Scaler, and Encoder) has the flag <code class="docutils literal notranslate"><span class="pre">-latency_logging</span></code>. When this is enabled, tags are added to the syslog <code class="docutils literal notranslate"><span class="pre">(/var/log/syslog)</span></code>. The script <code class="docutils literal notranslate"><span class="pre">latency_test.sh</span></code> will parse the syslog and report on each stage’s latency, as measured in milliseconds.</p>
<div class="section" id="latency-measurement-script">
<h4>Latency Measurement Script<a class="headerlink" href="#latency-measurement-script" title="Permalink to this headline">¶</a></h4>
<p>You will need to identify the PID for the <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> context and have <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to access the syslog to use this script. <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">-aux</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">ffmpeg</span></code> should return the PIDs of all instances of <code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code> running on your system.</p>
<p><a class="reference download internal" download="" href="../../_downloads/356d0614c25756df3330749942339ee5/latency_test.sh"><code class="xref download docutils literal notranslate"><span class="pre">latency_test.sh</span></code></a></p>
<p><strong>Usage</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo ./latency_test.sh /var/log/syslog &lt;PID&gt;

$ ./latency_test.sh /var/log/syslog 20796
rm: cannot remove &#39;*.log&#39;: No such file or directory
Ladder contexts =  0x555b83c37c10   0x555b83d29550
================== Generating logs for ./syslog log file =========================
=============== Done generating logs! Measuring now... =======================
Frames decoded =  4757
Average decoding latency =  125 ms
============== decoder done ===============
Frames encoded =  4750
Average encoding latency =  45 ms
============== encoder 1 done =============
Total frames encoded =  4750
Total average latency =  203 ms
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../xma/xma_apps.html" class="btn btn-neutral float-right" title="XMA Examples for the Xilinx Video SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.html" class="btn btn-neutral float-left" title="FFmpeg Examples using Software Filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on December 16, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx, Inc.
                              </span>
<!-- 															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul> -->
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>