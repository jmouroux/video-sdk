


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FFmpeg Examples using Software Filters" href="filters.html" />
    <link rel="prev" title="Environment Setup Instructions" href="../../setup.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
<!-- 																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul> -->
																</div>
															</div>
															<script type="text/javascript" src="../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Xilinx Video SDK
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation and Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Environment Setup</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials and Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">FFmpeg</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#system-setup">System Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-ffmpeg-examples">Simple FFmpeg Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#decode-only">Decode Only</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encode-only">Encode Only</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-transcode">Basic Transcode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decode-only-into-multiple-resolution-outputs">Decode Only Into Multiple-Resolution Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encode-only-into-multiple-resolution-outputs">Encode Only Into Multiple-Resolution Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transcode-with-multiple-resolution-outputs">Transcode With Multiple-Resolution Outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lower-latency-transcode-with-multiple-resolution-outputs">Lower-Latency Transcode With Multiple-Resolution Outputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#encoding-streams-to-4k">Encoding Streams to 4K</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#k-h-264-real-time-encode-only">4k H.264 Real-Time Encode Only</a></li>
<li class="toctree-l3"><a class="reference internal" href="#k-h-264-real-time-transcode">4k H.264 Real-Time Transcode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-multiple-ffmpeg-jobs">Running Multiple FFmpeg Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#faster-than-realtime">Faster than Realtime</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ftrt-on-a-single-alveo-u30-device">FTRT on a single Alveo U30 device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ftrt-across-multiple-alveo-u30-devices-for-maximum-fps">FTRT across multiple Alveo U30 devices for maximum FPS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#streaming-examples">Streaming Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#replay-saved-files-with-downscaling">Replay Saved Files with Downscaling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Software Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="quality_analysis.html">Visual Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xma/xma_apps.html">XMA-based Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../running_multiple_jobs.html">Running Multiple Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_apis.html">C API Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../card_management.html">Card Management and Recovery</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

            
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Xilinx Video SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>FFmpeg Tutorials for the Xilinx Video SDK</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ffmpeg-tutorials-for-the-xilinx-video-sdk">
<h1>FFmpeg Tutorials for the Xilinx Video SDK<a class="headerlink" href="#ffmpeg-tutorials-for-the-xilinx-video-sdk" title="Permalink to this headline">¶</a></h1>
<p>This page provides tutorials on how to use FFmpeg with the Xilinx Alveo U30. Detailed documentation for this specific topic can be found in the <a class="reference internal" href="../../using_ffmpeg.html"><span class="doc">Xilinx Video SDK User Guide</span></a>.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#system-setup" id="id2">System Setup</a></p></li>
<li><p><a class="reference internal" href="#simple-ffmpeg-examples" id="id3">Simple FFmpeg Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#decode-only" id="id4">Decode Only</a></p></li>
<li><p><a class="reference internal" href="#encode-only" id="id5">Encode Only</a></p></li>
<li><p><a class="reference internal" href="#basic-transcode" id="id6">Basic Transcode</a></p></li>
<li><p><a class="reference internal" href="#decode-only-into-multiple-resolution-outputs" id="id7">Decode Only Into Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#encode-only-into-multiple-resolution-outputs" id="id8">Encode Only Into Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#transcode-with-multiple-resolution-outputs" id="id9">Transcode With Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#lower-latency-transcode-with-multiple-resolution-outputs" id="id10">Lower-Latency Transcode With Multiple-Resolution Outputs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#encoding-streams-to-4k" id="id11">Encoding Streams to 4K</a></p>
<ul>
<li><p><a class="reference internal" href="#k-h-264-real-time-encode-only" id="id12">4k H.264 Real-Time Encode Only</a></p></li>
<li><p><a class="reference internal" href="#k-h-264-real-time-transcode" id="id13">4k H.264 Real-Time Transcode</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-multiple-ffmpeg-jobs" id="id14">Running Multiple FFmpeg Jobs</a></p></li>
<li><p><a class="reference internal" href="#faster-than-realtime" id="id15">Faster than Realtime</a></p>
<ul>
<li><p><a class="reference internal" href="#ftrt-on-a-single-alveo-u30-device" id="id16">FTRT on a single Alveo U30 device</a></p></li>
<li><p><a class="reference internal" href="#ftrt-across-multiple-alveo-u30-devices-for-maximum-fps" id="id17">FTRT across multiple Alveo U30 devices for maximum FPS</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#streaming-examples" id="id18">Streaming Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#replay-saved-files-with-downscaling" id="id19">Replay Saved Files with Downscaling</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The tutorials break down the commands, starting with simple steps using a single device. These are built upon to show 4K, faster than realtime, and multiple operations on the same device.</p>
<div class="section" id="system-setup">
<h2><a class="toc-backref" href="#id2">System Setup</a><a class="headerlink" href="#system-setup" title="Permalink to this headline">¶</a></h2>
<p>Ensure you have properly set up the environment via <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">/opt/xilinx/xcdr/setup.sh</span></code> as described in the <a class="reference internal" href="../../setup.html"><span class="doc">setup instructions</span></a>.</p>
<p>Xilinx provides a precompiled binary for ffmpeg, which is moved to the top of the system PATH.</p>
<p>Some of the examples read or write RAW files from disk (encode-only or decode-only pipelines). There is a chance that due to the massive bandwidth required for operating on these RAW files, you will notice a drop in FPS; this is not due to the U30 but the disk speeds. We recommend reading/writing from <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> which is a RAM disk.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="simple-ffmpeg-examples">
<h2><a class="toc-backref" href="#id3">Simple FFmpeg Examples</a><a class="headerlink" href="#simple-ffmpeg-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decode-only">
<span id="id1"></span><h3><a class="toc-backref" href="#id4">Decode Only</a><a class="headerlink" href="#decode-only" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/a459ddaaef1c9bdb18e620c1506d64d8/01_ffmpeg_decode_only.sh"><code class="xref download docutils literal notranslate"><span class="pre">01_ffmpeg_decode_only.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">01</span><span class="n">_ffmpeg_decode_only</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">H</span><span class="o">.</span><span class="mi">264</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example accepts a clip that is already encoded in H.264, and will decode the file into a RAW format and save it to disk.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">vf</span> <span class="n">xvbm_convert</span> <span class="o">-</span><span class="n">pix_fmt</span> <span class="n">yuv420p</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_dec_out</span><span class="o">.</span><span class="n">yuv</span>
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-vf</span> <span class="pre">xvbm_convert</span></code></p>
<ul>
<li><p>Internally, the decoder operates on Xilinx-typed buffers to improve performance and enable scalable options for future accelerated filters. To convert back to a host-buffer, you must execute this filter.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>We need to define the colorspace in the output</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_out.yuv</span></code></p>
<ul>
<li><p>The decoder will save the file to the path above</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="encode-only">
<h3><a class="toc-backref" href="#id5">Encode Only</a><a class="headerlink" href="#encode-only" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/072b10067d15193c2645fa2ee8637042/02_ffmpeg_encode_only_1080p.sh"><code class="xref download docutils literal notranslate"><span class="pre">02_ffmpeg_encode_only_1080p.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">02</span><span class="n">_ffmpeg_encode_only_1080p</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">YUV</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example accepts a RAW 1080p60 clip in YUV420 format. It will pass the clip to the encoder to produce an H.264 encoded MP4 output with a target bitrate of 8Mbps and save it to disk.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">f</span> <span class="n">rawvideo</span> <span class="o">-</span><span class="n">s</span> <span class="mi">1920</span><span class="n">x1080</span> <span class="o">-</span><span class="n">r</span> <span class="mi">60</span> <span class="o">-</span><span class="n">pix_fmt</span> <span class="n">yuv420p</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">8</span><span class="n">M</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">mp4</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_enc_out</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This signifies that the video is in a raw format, without container or other metadata/information about the clip</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">1920x1080</span></code></p>
<ul>
<li><p>Since there is no container or metadata in a RAW clip, the user must define the input clip’s resolution/size. This example states the input is 1080p</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">60</span></code></p>
<ul>
<li><p>Again, without metadata, the encoder requires the framerate of the incoming stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>The colorspace of the encoder is by default yuv420p. this example is defining the input clip as being this same colorspace</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">8M</span></code></p>
<ul>
<li><p>The target bitrate of the encoded stream. 8M signifies a target bitrate of 8 Megabits per second. You can also use 8000K or 8000000.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_enc_out.mp4</span></code></p>
<ul>
<li><p>Save the output in the path above</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basic-transcode">
<h3><a class="toc-backref" href="#id6">Basic Transcode</a><a class="headerlink" href="#basic-transcode" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/4dae87302d163ce2e29f58a9295ebb78/03_ffmpeg_transcode_only.sh"><code class="xref download docutils literal notranslate"><span class="pre">03_ffmpeg_transcode_only.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">03</span><span class="n">_ffmpeg_transcode_only</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">H</span><span class="o">.</span><span class="mi">264</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example takes an H.264 clip and reencodes it to H.264 with a new bitrate of 8Mbps. The output is writen into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_xcode.mp4</span></code>.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">f</span> <span class="n">mp4</span> <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">8</span><span class="n">M</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_xcode</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">8M</span></code></p>
<ul>
<li><p>The target bitrate of the encoded stream. 8M signifies a target bitrate of 8 Megabits per second. You can also use 8000K or 8000000.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_xcode.mp4</span></code></p>
<ul>
<li><p>This is the output path; most scripts will route here. Change to any output path at your discretion.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="decode-only-into-multiple-resolution-outputs">
<span id="decode-and-scale-only"></span><h3><a class="toc-backref" href="#id7">Decode Only Into Multiple-Resolution Outputs</a><a class="headerlink" href="#decode-only-into-multiple-resolution-outputs" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/ffc2642dbff7af23672a28fb84e04a66/04_ffmpeg_decode_plus_scale.sh"><code class="xref download docutils literal notranslate"><span class="pre">04_ffmpeg_decode_plus_scale.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">04</span><span class="n">_ffmpeg_decode_plus_scale</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">h264</span> <span class="n">clip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example decodes an existing H.264 file and then scales it into multiple resolutions as defined below. It will not re-encode them and save the RAW output to disk under <code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_scale&lt;res&gt;.yuv</span></code></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720:  out_1_rate=full: \
out_2_width=848:  out_2_height=480:  out_2_rate=half: \
out_3_width=640:  out_3_height=360:  out_3_rate=half: \
out_4_width=288:  out_4_height=160:  out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]; \
[aa]xvbm_convert[aa1];[abb]xvbm_convert[abb1];[b]xvbm_convert[b1];[c]xvbm_convert[c1]; \
[d]xvbm_convert[d1]&quot; \
-map &quot;[aa1]&quot;  -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_720p60.yuv \
-map &quot;[abb1]&quot; -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_720p30.yuv \
-map &quot;[b1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_480p30.yuv \
-map &quot;[c1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_360p30.yuv \
-map &quot;[d1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_288p30.yuv
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">fps</span></code> and <code class="docutils literal notranslate"><span class="pre">xvbm_convert</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-xvbm_convert"><code class="xref std std-option docutils literal notranslate"><span class="pre">xvbm_convert</span></code></a> filters are used to transfer the outputs of the hardware scaler back to the host and convert them to AV frames for further processing by FFmpeg</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>Use a yuv420p output format</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This tells ffmpeg to output the video into a RAW video file</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_scale_&lt;resolution&gt;&lt;fps&gt;.yuv</span></code></p>
<ul>
<li><p>Save the output files to the paths listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="encode-only-into-multiple-resolution-outputs">
<span id="encode-only-multiple-res-outputs"></span><h3><a class="toc-backref" href="#id8">Encode Only Into Multiple-Resolution Outputs</a><a class="headerlink" href="#encode-only-into-multiple-resolution-outputs" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/718fd8aecf024c21a9764e65ffefbb9b/05_ffmpeg_encode_plus_scale_1080p.sh"><code class="xref download docutils literal notranslate"><span class="pre">05_ffmpeg_encode_plus_scale_1080p.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">05</span><span class="n">_ffmpeg_encode_plus_scale_1080p</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">YUV</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example takes a raw 1080p60 YUV file, scales it down to different resolutions and frame rates, encodes each of the scaled streams to H.264 and saves them to disk under <code class="file docutils literal notranslate"><span class="pre">xil_scale_enc_&lt;resolution&gt;.mp4</span></code></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffmpeg -f rawvideo -s 1920x1080 -r 60 -pix_fmt yuv420p -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720: out_1_rate=full:   \
out_2_width=848:  out_2_height=480: out_2_rate=half:   \
out_3_width=640:  out_3_height=360: out_3_rate=half:   \
out_4_width=288:  out_4_height=160: out_4_rate=half    \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot;  \
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_288p30.mp4
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This signifies that the video is in a raw format, without container or other metadata/information about the clip</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">1920x1080</span></code></p>
<ul>
<li><p>Since there is no container or metadata in a RAW clip, the user must define the input clip’s resolution/size. This example states the input is 1080p</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">60</span></code></p>
<ul>
<li><p>Without metadata, the encoder requires the framerate of the incoming stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and  <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_scale_enc_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="transcode-with-multiple-resolution-outputs">
<h3><a class="toc-backref" href="#id9">Transcode With Multiple-Resolution Outputs</a><a class="headerlink" href="#transcode-with-multiple-resolution-outputs" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/8debda9c638965586b24d28f720ab1e6/06_ffmpeg_transcode_plus_scale.sh"><code class="xref download docutils literal notranslate"><span class="pre">06_ffmpeg_transcode_plus_scale.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">06</span><span class="n">_ffmpeg_transcode_plus_scale</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">h264</span> <span class="n">clip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example implements a complete transcoding pipeline on an 1080p60 H.264 input. It decodes the input stream, scales it down to different resolutions and frame rates, encodes each of the scaled streams to H.264 and saves them to disk under <code class="file docutils literal notranslate"><span class="pre">xil_xcode_scale_&lt;resolution&gt;.mp4</span></code></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720:  out_1_rate=full: \
out_2_width=848:  out_2_height=480:  out_2_rate=half: \
out_3_width=640:  out_3_height=360:  out_3_rate=half: \
out_4_width=288:  out_4_height=160:  out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab];[ab]fps=30[abb]&quot; \
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_288p30.mp4
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and  <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_scale_enc_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="lower-latency-transcode-with-multiple-resolution-outputs">
<h3><a class="toc-backref" href="#id10">Lower-Latency Transcode With Multiple-Resolution Outputs</a><a class="headerlink" href="#lower-latency-transcode-with-multiple-resolution-outputs" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/3491e0484726f9c1e46013e38911f68f/07_ffmpeg_transcode_plus_scale_lowlatency.sh"><code class="xref download docutils literal notranslate"><span class="pre">07_ffmpeg_transcode_plus_scale_lowlatency.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ffmpeg_transcode_plus_scale_low_latency</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">h264</span> <span class="n">clip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example is the same as #6, which is a full transcode pipeline (decode, scale, encode), saving the scaled outputs into the files <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_ll_xcode_scale_&lt;reso&gt;.mp4</span></code>. This differs in that is is a “low latency” version, which removes the B-frames, and reduces the lookahead. This, in short, decreases the latency at the cost of visual quality.</p>
<p>This example will output corrupt data if you provide an input file that contains B-Frames.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -entropy_buffers_count 2 -low_latency 1 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720: out_1_rate=full:   \
out_2_width=848:  out_2_height=480: out_2_rate=half:   \
out_3_width=640:  out_3_height=360: out_3_rate=half:   \
out_4_width=288:  out_4_height=160: out_4_rate=half    \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot; \
-map &quot;[aa]&quot;  -b:v 4M    -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_288p30.mp4
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-low_latency</span> <span class="pre">1</span></code></p>
<ul>
<li><p>This flag disables the Decoder’s ability to handle out-of-order frames (i.e. B-Frames). Decoding I and P frames only decreases the latency of the system.</p></li>
<li><p><strong>If your stream contains B-Frames, you will receive a corrupt output</strong></p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">-low_latency</span> <span class="pre">1</span></code> from the commandline if your input has B-Frames</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and  <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-bf</span> <span class="pre">0</span></code></p>
<ul>
<li><p>The number of b-frames inserted in the output stream not only increases encode latency in the Alveo U30 card, but decode latency on the player. Setting it to 0 removes them.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scaling-list</span> <span class="pre">0</span></code></p>
<ul>
<li><p>Disables the scaling list, which is a pre-encode processing which normally adds to the latency of the pipeline.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_ll_xcode_scale_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="encoding-streams-to-4k">
<h2><a class="toc-backref" href="#id11">Encoding Streams to 4K</a><a class="headerlink" href="#encoding-streams-to-4k" title="Permalink to this headline">¶</a></h2>
<p>The U30 Video SDK solution supports real-time decoding and encoding of 4k streams with the following notes:</p>
<ul class="simple">
<li><p>The U30 video pipeline is optimized for live-streaming use cases. For 4k streams with bitrates significantly higher than the ones typically used for live streaming, it may not be possible to sustain real-time performance.</p></li>
<li><p>When decoding 4k streams with a high bitrate, increasing the number of entropy buffers using the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-entropy_buffers_count"><code class="xref std std-option docutils literal notranslate"><span class="pre">-entropy_buffers_count</span></code></a> option can help improve performance</p></li>
<li><p>When encoding raw video to 4k, set the <code class="xref std std-option docutils literal notranslate"><span class="pre">-s</span></code> option to <code class="docutils literal notranslate"><span class="pre">3840x2160</span></code> to specify the desired resolution.</p></li>
<li><p>When encoding 4k streams to H.264, the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance. A value of 4 is recommended. This option is not required when encoding to HEVC.</p></li>
<li><p>The lookahead feature is not supported for 4k. FFmpeg will give an error if <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-lookahead_depth"><code class="xref std std-option docutils literal notranslate"><span class="pre">-lookahead_depth</span></code></a> is enabled when encoding to 4k.</p></li>
</ul>
<div class="section" id="k-h-264-real-time-encode-only">
<h3><a class="toc-backref" href="#id12">4k H.264 Real-Time Encode Only</a><a class="headerlink" href="#k-h-264-real-time-encode-only" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/a2ce8145d234de33fd7483b7cad931ce/08_ffmpeg_encode_only_4k.sh"><code class="xref download docutils literal notranslate"><span class="pre">08_ffmpeg_encode_only_4k.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">08</span><span class="n">_ffmpeg_encode_only_4k</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">2160</span><span class="n">p60</span> <span class="n">YUV</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example takes an 8-bit, YUV420, 2160p60 RAW file, encodes it to H.264 at a rate of 20Mbps and writes the result into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_4k_enc_out.mp4</span></code>. The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance when encoding a 4k stream to H.264.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">f</span> <span class="n">rawvideo</span> <span class="o">-</span><span class="n">s</span> <span class="mi">3840</span><span class="n">x2160</span> <span class="o">-</span><span class="n">r</span> <span class="mi">60</span> <span class="o">-</span><span class="n">pix_fmt</span> <span class="n">yuv420p</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">20</span><span class="n">M</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">slices</span> <span class="mi">4</span> <span class="o">-</span><span class="n">f</span> <span class="n">mp4</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_4k_enc_out</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
</div>
<div class="section" id="k-h-264-real-time-transcode">
<h3><a class="toc-backref" href="#id13">4k H.264 Real-Time Transcode</a><a class="headerlink" href="#k-h-264-real-time-transcode" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/b085165af1826912f69e741252f5aa8a/09_ffmpeg_transcode_only_4k.sh"><code class="xref download docutils literal notranslate"><span class="pre">09_ffmpeg_transcode_only_4k.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">09</span><span class="n">_ffmpeg_transcode_only_4k</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">2160</span><span class="n">p60</span> <span class="n">HEVC</span> <span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This example takes an 2160p60 HEVC file, transcodes it to H.264 at a rate of 20Mbps and writes the result into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_4k_enc_out.mp4</span></code>. The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance when encoding a 4k stream to H.264.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_hevc</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">20</span><span class="n">M</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">slices</span> <span class="mi">4</span> <span class="o">-</span><span class="n">f</span> <span class="n">mp4</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_4k_xcode</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="running-multiple-ffmpeg-jobs">
<span id="multiple-ffmpeg-jobs-example"></span><h2><a class="toc-backref" href="#id14">Running Multiple FFmpeg Jobs</a><a class="headerlink" href="#running-multiple-ffmpeg-jobs" title="Permalink to this headline">¶</a></h2>
<p>So far we’ve run one job at a time, even if the job does not use all the resources available on the device. The Video SDK makes it possible to run multiple FFmpeg jobs in parallel on a device or across multiple devices.</p>
<p>This script transcodes three H264 streams to HEVC, sending the outputs to /tmp/xil_xcode_{n}.mp4. The three transcodes are run in parallel in individual xterms. The FFmpeg <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-xlnx_hwdev"><code class="xref std std-option docutils literal notranslate"><span class="pre">-xlnx_hwdev</span></code></a> is used to control on which device each job is run. The first job is run on device #0 and the two others jobs are run on device #1. After the jobs are launched, a JSON system load report is generated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example leverages the <code class="docutils literal notranslate"><span class="pre">xterm</span></code> program. Make sure it is installed on your system before proceeding.</p>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/909030b9160393359a93e22f9b1a0802/10_ffmpeg_multiple_jobs.sh"><code class="xref download docutils literal notranslate"><span class="pre">10_ffmpeg_multiple_jobs.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">10</span><span class="n">_ffmpeg_multiple_jobs</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="n">input_h264_1_mp4</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">input_h264_2_mp4</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">input_h264_3_mp4</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Commands</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Launch the three jobs in parallel</span>
<span class="n">xterm</span> <span class="o">-</span><span class="n">fa</span> <span class="n">mono</span><span class="p">:</span><span class="n">size</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">hold</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;ffmpeg -xlnx_hwdev 0 -c:v mpsoc_vcu_h264 -i $1 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_1.mp4&quot;</span> <span class="o">&amp;</span>
<span class="n">xterm</span> <span class="o">-</span><span class="n">fa</span> <span class="n">mono</span><span class="p">:</span><span class="n">size</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">hold</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;ffmpeg -xlnx_hwdev 1 -c:v mpsoc_vcu_h264 -i $2 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_2.mp4&quot;</span> <span class="o">&amp;</span>
<span class="n">xterm</span> <span class="o">-</span><span class="n">fa</span> <span class="n">mono</span><span class="p">:</span><span class="n">size</span><span class="o">=</span><span class="mi">9</span> <span class="o">-</span><span class="n">hold</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;ffmpeg -xlnx_hwdev 1 -c:v mpsoc_vcu_h264 -i $3 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_3.mp4&quot;</span> <span class="o">&amp;</span>

<span class="c1"># Wait until the jobs are started to generate a system load report</span>
<span class="n">sleep</span> <span class="mi">2</span><span class="n">s</span>
<span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">list_cmd</span><span class="o">.</span><span class="n">json</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p><strong>Tutorial steps</strong></p>
<ul>
<li><p>Prepare 3 input H264 videos with the following resolutions: 4k60, 1080p60 and 720p30</p></li>
<li><p>Confirm there are a least two devices available in your system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil</span> <span class="n">examine</span>
</pre></div>
</div>
</li>
<li><p>Run the example script with the 3 input videos:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">10</span><span class="n">_ffmpeg_multiple_jobs</span><span class="o">.</span><span class="n">sh</span> <span class="mi">4</span><span class="n">k60</span><span class="o">.</span><span class="n">mp4</span> <span class="mi">1080</span><span class="n">p60</span><span class="o">.</span><span class="n">mp4</span> <span class="mi">720</span><span class="n">p30</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
</li>
<li><p>The script opens three xterm windows and runs a transcode job in each of them. After 2 seconds, to ensure all jobs are running, the script executes the <code class="docutils literal notranslate"><span class="pre">xrmadm</span> <span class="pre">/opt/xilinx/xrm/test/list_cmd.json</span></code> command to generate a report of the system load.</p></li>
<li><p>In each of the xterm windows, inspect the FFmpeg transcript and observe that it indicates on which device the job is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">device_id</span>   <span class="p">:</span>  <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>Inspect the system load report (in JSON format) in the main terminal. For each device, the loading percentage is reported in the <code class="docutils literal notranslate"><span class="pre">usedLoad</span></code> field for each of the decoder, scaler, and encoder compute units. A value of 0 indicates that a particular resources is completely free. A value of 1000000 indicates that a particular resource is fully loaded and can no longer accept jobs. In the example shown below, the decoder is 25% utilized and can therefore accept more jobs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;cu_3&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;cuId         &quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cuType       &quot;</span><span class="p">:</span> <span class="s2">&quot;IP Kernel&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kernelName   &quot;</span><span class="p">:</span> <span class="s2">&quot;decoder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kernelAlias  &quot;</span><span class="p">:</span> <span class="s2">&quot;DECODER_MPSOC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;instanceName &quot;</span><span class="p">:</span> <span class="s2">&quot;decoder_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cuName       &quot;</span><span class="p">:</span> <span class="s2">&quot;decoder:decoder_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kernelPlugin &quot;</span><span class="p">:</span> <span class="s2">&quot;/opt/xilinx/xma_plugins/libvcu-xma-dec-plg.so&quot;</span><span class="p">,</span>
    <span class="s2">&quot;maxCapacity  &quot;</span><span class="p">:</span> <span class="s2">&quot;497664000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;numChanInuse &quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usedLoad     &quot;</span><span class="p">:</span> <span class="s2">&quot;250000 of 1000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reservedLoad &quot;</span><span class="p">:</span> <span class="s2">&quot;0 of 1000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resrvUsedLoad&quot;</span><span class="p">:</span> <span class="s2">&quot;0 of 1000000&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Close the three xterm windows</p></li>
<li><p>Now rerun the script with the input files in a different order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">10</span><span class="n">_ffmpeg_multiple_jobs</span><span class="o">.</span><span class="n">sh</span> <span class="mi">720</span><span class="n">p30</span><span class="o">.</span><span class="n">mp4</span> <span class="mi">4</span><span class="n">k60</span><span class="o">.</span><span class="n">mp4</span> <span class="mi">1080</span><span class="n">p60</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>This will try to simultaneously run the 4k60 and the 1080p60 jobs on device #1. The compute requirements of these two combined jobs will exceed the capacity of a single device. Only one of the two jobs will proceed and the second one will error out due to insufficient resources.</p>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="faster-than-realtime">
<span id="faster-than-realtime-example"></span><h2><a class="toc-backref" href="#id15">Faster than Realtime</a><a class="headerlink" href="#faster-than-realtime" title="Permalink to this headline">¶</a></h2>
<p>The Alveo U30 card is optimized for low latency “realtime” applications. That is to say, it provides deterministic low latency transcoding, while operating at the FPS the human eye would normally process/watch it. This is ideal for ingesting a live video stream where there is minimal buffering.</p>
<p>Faster Than Real Time (FTRT) is almost the contrary: you have the entire file/clip saved and can therefore “divide and conquer”. There are two main flags to consider when processing in this flow: <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-cores"><code class="xref std std-option docutils literal notranslate"><span class="pre">-cores</span></code></a> and <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a>.</p>
<div class="section" id="ftrt-on-a-single-alveo-u30-device">
<h3><a class="toc-backref" href="#id16">FTRT on a single Alveo U30 device</a><a class="headerlink" href="#ftrt-on-a-single-alveo-u30-device" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/a4ed066097d65ed362b3d57b67cceb43/11_ffmpeg_ftrt_transcode_only.sh"><code class="xref download docutils literal notranslate"><span class="pre">11_ffmpeg_ftrt_transcode_only.sh</span></code></a></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ffmpeg</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">f</span> <span class="n">mp4</span> <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">8</span><span class="n">M</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">cores</span> <span class="mi">4</span> <span class="o">-</span><span class="n">slices</span> <span class="mi">4</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_ftrt_xcode</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated decoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span></code></p>
<ul>
<li><p>The target bitrate for video will follow</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">8M</span></code></p>
<ul>
<li><p>This signifies 8-Megabits per second target bitrate. You can also use 10000K or 10000000.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-cores</span> <span class="pre">4</span></code></p>
<ul>
<li><p>Each device on the Alveo U30 internally uses 4x engines/subcores of 1080p60; when targeting 4k resolutions, it will automatically detect and utilize more subcores to maintain realtime performance.</p></li>
<li><p>Forcing the device to use more cores than necessary will enable more FPS</p></li>
<li><p>Using more cores on a clip/stream that cannot provide more FPS will waste resources and have no effect</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-slices</span> <span class="pre">4</span></code></p>
<ul>
<li><p>A video bitstream is broken down into segments called “slices”.</p></li>
<li><p>Enabling the system to operate on multiple slices at a time has the benefit of improving FPS, but will adversely affect Visual Quality, as motion estimation within a segment of the frame is being operated on separately, will not be able to communicate with each other, so they may have visual artifacts.</p></li>
<li><p>Please see our Visual Quality page to run an analysis to determine if the FPS gain is worth a reduction in VQ.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_ftrt_xcode.mp4</span></code></p>
<ul>
<li><p>This is the output path; most scripts will route here. Change to any output path at your discretion.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ftrt-across-multiple-alveo-u30-devices-for-maximum-fps">
<h3><a class="toc-backref" href="#id17">FTRT across multiple Alveo U30 devices for maximum FPS</a><a class="headerlink" href="#ftrt-across-multiple-alveo-u30-devices-for-maximum-fps" title="Permalink to this headline">¶</a></h3>
<p>When processing file-based solutions, where you have the entire clip to operate on in a single command, you have the option to split the video into segments, and distribute the segments to individual encoder instances (for Alveo U30, these would be devices on the card). While there is some overhead in “splitting” the clip to begin with, and “stitching” the output files into a single output file, these costs are almost always outweighed by the improvement in FPS.</p>
<p>The function below will split the clip on a boundary that ensures no visual quality is lost (a closed GOP boundary), and will distribute the clip across all available Alveo U30 cards in the system. If you inspect the script, you may edit it to apply the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-cores"><code class="xref std std-option docutils literal notranslate"><span class="pre">-cores</span></code></a> and <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> flags as listed above for an even larger increase in FPS. Remember that <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> will adversely affect VQ.</p>
<p>The load-balancing of this example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-xlnx_hwdev"><code class="xref std std-option docutils literal notranslate"><span class="pre">-xlnx_hwdev</span></code></a> flag, which manually utilizes available slots as they are available, systematically filling the cards from “index 0” to “index N”</p>
<p><a class="reference download internal" download="" href="../../_downloads/b0cc2b14cc6b8d91f4bfab9d71b70133/13_ffmpeg_transcode_only_split_stitch.py"><code class="xref download docutils literal notranslate"><span class="pre">13_ffmpeg_transcode_only_split_stitch.py</span></code></a></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="mi">13</span><span class="n">_ffmpeg_transcode_only_split_stitch</span><span class="o">.</span><span class="n">py</span> \
<span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">INPUT</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">xil_split_stitch</span><span class="o">.</span><span class="n">mp4</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">SPLIT_COUNT</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">INPUT_CODEC</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">o</span> <span class="o">&lt;</span><span class="n">OUTPUT_CODEC</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">b</span> <span class="o">&lt;</span><span class="n">BITRATE</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>To break down the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">python</span></code></p>
<ul>
<li><p>This calls the local system python to execute. This has been tested on Python3 only.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>This is the pre-encoded input file (not RAW) in either H.264 or h.265 (HEVC) format</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">/tmp/xil_split_stitch.mp4</span></code></p>
<ul>
<li><p>This is the output path; most scripts will route here. Change to any output path at your discretion</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">&lt;SPLIT_COUNT&gt;</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;SPLIT_COUNT&gt;</span></code> is an integer number from <code class="docutils literal notranslate"><span class="pre">{1..MAXCARDS*2}</span></code>. This is the number of Alveo U30 devices you wish to deploy your workload on to. Since each Alveo U30 card has two devices, the maximum number will be the number of cards in your system times two.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT_CODEC&gt;</span></code></p>
<ul>
<li><p>This defines the input file’s pre-encoded format: supported formats are <code class="docutils literal notranslate"><span class="pre">h264</span></code>, <code class="docutils literal notranslate"><span class="pre">hevc</span></code>, and <code class="docutils literal notranslate"><span class="pre">h265</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">h265</span></code> and <code class="docutils literal notranslate"><span class="pre">hevc</span></code> are identical; they are provided for ease of customer use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">&lt;OUTPUT_CODEC&gt;</span></code></p>
<ul>
<li><p>This defines the desired output encoder format: supported formats are <code class="docutils literal notranslate"><span class="pre">h264</span></code>, <code class="docutils literal notranslate"><span class="pre">hevc</span></code>, and <code class="docutils literal notranslate"><span class="pre">h265</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">h265</span></code> and <code class="docutils literal notranslate"><span class="pre">hevc</span></code> are identical; they are provided for ease of customer use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">&lt;BITRATE&gt;</span></code></p>
<ul>
<li><p>This is a float or integer value which defines the output file’s target bitrate in Mbits/s. Valid values are comprised between 1.0 and 25.0. The default value is 5.0. Example: use -b 3 to specify an output bitrate of 3Mbits/s.</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="streaming-examples">
<h2><a class="toc-backref" href="#id18">Streaming Examples</a><a class="headerlink" href="#streaming-examples" title="Permalink to this headline">¶</a></h2>
<p>Streaming Examples operate largely on the same principles (and commandline strings) as file-based operations. However, the main difference is how streams are received and transmitted.</p>
<p>These examples is will leverage example #6, which is a full transcode pipeline (decode, scale, encode), however, instead of saving the scaled outputs into monolithic MP4 files, will create a “manifest” file <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> for streaming along with several <code class="docutils literal notranslate"><span class="pre">.ts</span></code> files with the actual playback data. These manifest files, when inspected, will contain a “playlist” of clips with <code class="docutils literal notranslate"><span class="pre">.ts</span></code> extentions, which are of duration <code class="docutils literal notranslate"><span class="pre">hls_time</span></code>. Creating separate clips enables the remote playback players to “drop quality” instanatneously without any buffering to the viewer, or trying to figure out and seek to “where we are in the clip”. This is how most live streaming is done, however there are other, similar protocolos (e.g. DASH) which operate on similar principles.</p>
<p>These flags, and others, are defined further on the <a class="reference external" href="https://ffmpeg.org/ffmpeg-formats.html">FFmpeg main help page</a></p>
<div class="section" id="replay-saved-files-with-downscaling">
<h3><a class="toc-backref" href="#id19">Replay Saved Files with Downscaling</a><a class="headerlink" href="#replay-saved-files-with-downscaling" title="Permalink to this headline">¶</a></h3>
<p><a class="reference download internal" download="" href="../../_downloads/6c862aa57d4033a7109333412b0ee236/12_ffmpeg_streaming_transcode_from_file.sh"><code class="xref download docutils literal notranslate"><span class="pre">12_ffmpeg_streaming_transcode_from_file.sh</span></code></a></p>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="mi">12</span><span class="n">_ffmpeg_streaming_transcode_from_file</span><span class="o">.</span><span class="n">sh</span> <span class="o">&lt;</span><span class="mi">1080</span><span class="n">p60</span> <span class="n">h264</span> <span class="n">clip</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The flows is for representative use</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i  $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720:  out_1_rate=full: \
out_2_width=848:  out_2_height=480:  out_2_rate=half: \
out_3_width=640:  out_3_height=360:  out_3_rate=half: \
out_4_width=288:  out_4_height=160:  out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot;\
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_720p60.m3u8 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_720p30.m3u8 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_480p30.m3u8 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_360p30.m3u8 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_288p30.m3u8
</pre></div>
</div>
<p>To break down the flags:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span> <span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span> <span class="pre">-i</span> <span class="pre">$1</span></code></p>
<ul class="simple">
<li><p>This calls the Xilinx FFmpeg, decodes using the Alveo U30 hardware decoder, an input file <code class="docutils literal notranslate"><span class="pre">$1</span></code></p></li>
</ul>
</li>
<li><p>The filter graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">filter_complex</span> <span class="s2">&quot;multiscale_xma=outputs=4: </span><span class="se">\</span>
<span class="s2">out_1_width=1280: out_1_height=720:  out_1_rate=full: </span><span class="se">\</span>
<span class="s2">out_2_width=848:  out_2_height=480:  out_2_rate=half: </span><span class="se">\</span>
<span class="s2">out_3_width=640:  out_3_height=360:  out_3_rate=half: </span><span class="se">\</span>
<span class="s2">out_4_width=288:  out_4_height=160:  out_4_rate=half  </span><span class="se">\</span>
<span class="s2">[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot;</span>\
<span class="o">-</span><span class="nb">map</span> <span class="s2">&quot;[aa]&quot;</span>  <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">4</span><span class="n">M</span>    <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">hls</span> <span class="o">-</span><span class="n">hls_time</span> <span class="mi">4</span> <span class="o">-</span><span class="n">hls_list_size</span> <span class="mi">5</span> <span class="o">-</span><span class="n">hls_flags</span> <span class="n">delete_segments</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">xil_xcode_stream_scale_720p60</span><span class="o">.</span><span class="n">m3u8</span> \
<span class="o">-</span><span class="nb">map</span> <span class="s2">&quot;[abb]&quot;</span> <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">3</span><span class="n">M</span>    <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">hls</span> <span class="o">-</span><span class="n">hls_time</span> <span class="mi">4</span> <span class="o">-</span><span class="n">hls_list_size</span> <span class="mi">5</span> <span class="o">-</span><span class="n">hls_flags</span> <span class="n">delete_segments</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">xil_xcode_stream_scale_720p30</span><span class="o">.</span><span class="n">m3u8</span> \
<span class="o">-</span><span class="nb">map</span> <span class="s2">&quot;[b]&quot;</span>   <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">2500</span><span class="n">K</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">hls</span> <span class="o">-</span><span class="n">hls_time</span> <span class="mi">4</span> <span class="o">-</span><span class="n">hls_list_size</span> <span class="mi">5</span> <span class="o">-</span><span class="n">hls_flags</span> <span class="n">delete_segments</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">xil_xcode_stream_scale_480p30</span><span class="o">.</span><span class="n">m3u8</span> \
<span class="o">-</span><span class="nb">map</span> <span class="s2">&quot;[c]&quot;</span>   <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">1250</span><span class="n">K</span> <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">hls</span> <span class="o">-</span><span class="n">hls_time</span> <span class="mi">4</span> <span class="o">-</span><span class="n">hls_list_size</span> <span class="mi">5</span> <span class="o">-</span><span class="n">hls_flags</span> <span class="n">delete_segments</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">xil_xcode_stream_scale_360p30</span><span class="o">.</span><span class="n">m3u8</span> \
<span class="o">-</span><span class="nb">map</span> <span class="s2">&quot;[d]&quot;</span>   <span class="o">-</span><span class="n">b</span><span class="p">:</span><span class="n">v</span> <span class="mi">625</span><span class="n">K</span>  <span class="o">-</span><span class="n">c</span><span class="p">:</span><span class="n">v</span> <span class="n">mpsoc_vcu_h264</span> <span class="o">-</span><span class="n">f</span> <span class="n">hls</span> <span class="o">-</span><span class="n">hls_time</span> <span class="mi">4</span> <span class="o">-</span><span class="n">hls_list_size</span> <span class="mi">5</span> <span class="o">-</span><span class="n">hls_flags</span> <span class="n">delete_segments</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">xil_xcode_stream_scale_288p30</span><span class="o">.</span><span class="n">m3u8</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This takes the 1080p60 input and converts it to 5x streams of 720p60, 720p30, 480p30, 360p30, and 160p30</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul class="simple">
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul class="simple">
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-acclerated encoder in the Alveo U30 card</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">hls</span></code></p>
<ul class="simple">
<li><p>Sets the output video container to an HLS manifest file <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> and the actual clip data <code class="docutils literal notranslate"><span class="pre">.ts</span></code> files.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls_time</span> <span class="pre">4</span></code></p>
<ul class="simple">
<li><p>This sets the duration of all the HLS clips to 4 seconds</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls_list_size</span> <span class="pre">5</span></code></p>
<ul class="simple">
<li><p>This sets the list of accessible/available clips to 5. Can be used to prebuffer the player at the remote end.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls</span> <span class="pre">flags</span> <span class="pre">delete_segments</span></code></p>
<ul class="simple">
<li><p>This flag will delete all segments after the <code class="docutils literal notranslate"><span class="pre">hls_list_size</span></code> is reached, saving disk space.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul class="simple">
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/www/html/xil_xcode_stream_scale&lt;resolution&gt;&lt;fps&gt;.m3u8</span></code></p>
<ul class="simple">
<li><p>Saves the output clips, split into size of <code class="docutils literal notranslate"><span class="pre">hls_time</span></code> into <code class="docutils literal notranslate"><span class="pre">.ts</span></code> clips, indexed by the <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> manifest file.</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="filters.html" class="btn btn-neutral float-right" title="FFmpeg Examples using Software Filters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../setup.html" class="btn btn-neutral float-left" title="Environment Setup Instructions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on September 03, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx, Inc.
                              </span>
<!-- 															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul> -->
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>